<!DOCTYPE html>
<html style="font-size: 16px;" lang="es"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="Características clave, Perfección del diseño, Centro de negocios">
    <meta name="description" content="">
    <title>Casa</title>
   
      <!-- Enlaces a los archivos CSS -->
      <link rel="stylesheet" href="{{ url_for('static', filename='./css/site.css') }}">
      <link rel="stylesheet" href="{{ url_for('static', filename='./css/page.css') }}">
      <link rel="stylesheet" href="{{ url_for('static', filename='./css/nicepage.css') }}">
      <link rel="stylesheet" href="{{ url_for('static', filename='./css/reconocimiento.css') }}">
  
      <!-- Enlaces a los archivos JS -->
      <script src="{{ url_for('static', filename='./js/jquery.js') }}"></script>
      <script src="{{ url_for('static', filename='./js/page.js') }}"></script>
 
    <meta name="generator" content="Nicepage 7.0.5, nicepage.com">
    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
    <link id="u-page-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Condensed:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i|Titillium+Web:200,200i,300,300i,400,400i,600,600i,700,700i,900|Raleway:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i">
    <meta name="theme-color" content="#478ac9">
    <meta property="og:title" content="Casa">
    <meta property="og:type" content="website">
  

    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Comfortaa:300,400,500,600,700">
    <link id="u-page-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Comfortaa:300,400,500,600,700">
    <style>
      .mensaje-flotante {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: rgba(0, 128, 0, 0.8);
    color: #fff;
    padding: 10px 20px;
    border-radius: 5px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    display: none;
    z-index: 1000;
    font-size: 16px;
}

    </style>
    
  </head>
  <body data-path-to-root="../" data-include-products="false" class="u-body u-xl-mode" data-lang="es"><header class="u-clearfix u-header u-header" id="sec-1054"><div class="u-clearfix u-sheet u-sheet-1">
    <div class="u-clearfix u-group-elements u-group-elements-1" data-animation-name="customAnimationIn" data-animation-duration="1000" data-animation-delay="0">
      <a href="#" class="u-image u-logo u-image-1" data-image-width="600" data-image-height="600">
        <img src="{{ url_for('static', filename='images/151852.png') }}" alt="Imagen" class="u-logo-image u-logo-image-1">
      </a>
      <img class="u-image u-image-contain u-image-default u-image-2" <img src="{{ url_for('static', filename='images/elpoderdeservir.png') }}"alt="" data-image-width="4590" data-image-height="1866">
    </div>
    <h1 class="u-align-center u-custom-font u-font-georgia u-text u-text-1" data-custom-animation="{&quot;animation&quot;:{&quot;XXL&quot;:{&quot;steps&quot;:[],&quot;hidden&quot;:false,&quot;start&quot;:{&quot;at&quot;:&quot;bottom&quot;,&quot;off&quot;:0},&quot;end&quot;:{&quot;at&quot;:&quot;top&quot;,&quot;off&quot;:0}},&quot;XL&quot;:{&quot;steps&quot;:[{&quot;dist&quot;:0.41,&quot;skip&quot;:0,&quot;blur&quot;:&quot;29&quot;,&quot;sticky&quot;:false,&quot;fixed&quot;:true,&quot;mx&quot;:0,&quot;my&quot;:0,&quot;op&quot;:0,&quot;rot&quot;:0,&quot;sx&quot;:3,&quot;sy&quot;:3,&quot;bgy&quot;:0}],&quot;hidden&quot;:false,&quot;start&quot;:{&quot;at&quot;:&quot;middle&quot;,&quot;off&quot;:0},&quot;end&quot;:{&quot;at&quot;:&quot;top&quot;,&quot;off&quot;:0}},&quot;LG&quot;:{&quot;steps&quot;:[],&quot;hidden&quot;:false,&quot;start&quot;:{&quot;at&quot;:&quot;bottom&quot;,&quot;off&quot;:0},&quot;end&quot;:{&quot;at&quot;:&quot;top&quot;,&quot;off&quot;:0}},&quot;MD&quot;:{&quot;steps&quot;:[],&quot;hidden&quot;:false,&quot;start&quot;:{&quot;at&quot;:&quot;bottom&quot;,&quot;off&quot;:0},&quot;end&quot;:{&quot;at&quot;:&quot;top&quot;,&quot;off&quot;:0}},&quot;SM&quot;:{&quot;steps&quot;:[],&quot;hidden&quot;:true,&quot;start&quot;:{&quot;at&quot;:&quot;bottom&quot;,&quot;off&quot;:0},&quot;end&quot;:{&quot;at&quot;:&quot;top&quot;,&quot;off&quot;:0}},&quot;XS&quot;:{&quot;steps&quot;:[],&quot;hidden&quot;:true,&quot;start&quot;:{&quot;at&quot;:&quot;bottom&quot;,&quot;off&quot;:0},&quot;end&quot;:{&quot;at&quot;:&quot;top&quot;,&quot;off&quot;:0}}},&quot;container&quot;:&quot;&quot;}">Tecnológicos de Estudios Superiores De Jocotitlan <br>
      <span class="u-text-custom-color-1">_______________________________________________</span>
      <span class="u-text-custom-color-1"></span>
      <br>
      <span style="font-size: 1rem;">Sistema de Control Escolar WEB&nbsp;</span>
      <br>
    </h1>
    <img class="u-image u-image-contain u-image-default u-image-3" <img src="{{ url_for('static', filename='images/369-3698095_escudo-de-mexico-png.png') }}" alt="" data-image-width="1085" data-image-height="687" data-animation-name="customAnimationIn" data-animation-duration="1000" data-animation-delay="0">
  </div></header>
    <section class="u-clearfix u-image u-section-1" id="sec-dd91" data-image-width="275" data-image-height="183">
      <div class="u-clearfix u-sheet u-sheet-1">
        <div class="u-align-center u-container-align-center u-container-align-center-sm u-container-align-center-xs u-container-style u-expanded-width-sm u-expanded-width-xs u-grey-15 u-group u-opacity u-opacity-60 u-group-1">
          <div class="u-container-layout u-container-layout-1">
            <h1 class="u-align-center-sm u-align-center-xs u-custom-font u-font-roboto-condensed u-text u-text-custom-color-1 u-title u-text-1">Sistema Reconocimiento Facial&nbsp;</h1>
           
          </div>
        </div>
      </div>
    </section>
    <section class="u-clearfix u-palette-5-light-3 u-section-2" id="sec-fb9e">
      <div class="u-clearfix u-sheet u-sheet-1">
        <div class="data-layout-selected u-align-left u-clearfix u-expanded-width u-gutter-10 u-layout-wrap u-palette-5-base u-layout-wrap-1">
          <div class="u-layout" style="">
            <div class="u-layout-row" style="">
              <div class="u-container-style u-layout-cell u-left-cell u-size-30 u-size-xs-60 u-layout-cell-1" src="">
                <div class="u-container-layout u-container-layout-1">
               

                <video id="videoElement" width="640" height="480" autoplay></video>
                <div id="loading" style="display: none;">Reconociendo rostro...</div>
                <div id="mensaje-flotante" class="mensaje-flotante">
                  <span id="mensaje-texto"></span>
                  <audio id="mensaje-audio" src="/static/audio/ONLINE.mp3"></audio>

               
              </div>
              
                <div id="result"></div> <!-- Aquí se mostrarán los resultados del reconocimiento -->
                <div id="redirectButton" style="display: none;">
                    <button style="padding: 10px 20px; background-color: #28a745; color: white; border: none; border-radius: 5px; font-size: 16px;" onclick="redireccionar()"> Rostro Reconocido</button>
                </div> <!-- Este botón aparecerá cuando se reconozca el rostro -->
                
                <!-- Botón para iniciar la cámara -->
                <button id="startButton" style="padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; font-size: 16px;">Iniciar cámara</button>
                
                <!-- Botón para detener la cámara -->
                <button id="stopButton" style="padding: 10px 20px; background-color: #dc3545; color: white; border: none; border-radius: 5px; font-size: 16px;" disabled>Detener cámara</button>
                
                <!-- Botón para cerrar el servidor -->
                <button id="closeServerButton" style="padding: 10px 20px; background-color: #ff5733; color: white; border: none; border-radius: 5px; font-size: 16px;">Cerrar servidor</button>
                
<script>
   const videoElement = document.getElementById("videoElement");
const startButton = document.getElementById("startButton");
const stopButton = document.getElementById("stopButton");
const resultDiv = document.getElementById("result");
const loadingDiv = document.getElementById("loading");
const redirectButtonDiv = document.getElementById("redirectButton");
const closeServerButton = document.getElementById("closeServerButton");

let mediaStream;
let reconocimientoEnProgreso = false;

// Función para iniciar la cámara
function startCamera() {
    navigator.mediaDevices.getUserMedia({ video: true })
        .then(function(stream) {
            mediaStream = stream;
            videoElement.srcObject = stream;
            startButton.disabled = true;
            stopButton.disabled = false;
        })
        .catch(function(error) {
            console.error("Error al acceder a la cámara: ", error);
            alert("No se pudo acceder a la cámara.");
        });
}

// Función para detener la cámara
function stopCamera() {
    let tracks = mediaStream.getTracks();
    tracks.forEach(track => track.stop());
    videoElement.srcObject = null;
    startButton.disabled = false;
    stopButton.disabled = true;
}

// Función para capturar un frame del video
function capturarFrame() {
    const canvas = document.createElement('canvas');
    canvas.width = videoElement.videoWidth;
    canvas.height = videoElement.videoHeight;
    const context = canvas.getContext('2d');
    context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
    return canvas.toDataURL('image/png'); // Retorna la imagen en formato Base64
}
function mostrarMensajeFlotante(mensaje, audioSrc) {
    const mensajeFlotante = document.getElementById('mensaje-flotante');
    const mensajeTexto = document.getElementById('mensaje-texto');
    const mensajeAudio = document.getElementById('mensaje-audio');

    mensajeTexto.textContent = mensaje; // Establece el texto del mensaje
    mensajeAudio.src = audioSrc; // Establece la fuente del audio
    mensajeFlotante.style.display = 'block'; // Muestra el mensaje flotante

    mensajeAudio.play().catch(error => console.error('Error al reproducir el audio:', error));

    // Ocultar el mensaje después de 3 segundos
    setTimeout(() => {
        mensajeFlotante.style.display = 'none';
    }, 3000);
}

function reconocerRostro() {
    if (reconocimientoEnProgreso) return;

    reconocimientoEnProgreso = true;
    loadingDiv.style.display = 'block';
    resultDiv.innerHTML = '';
    redirectButtonDiv.style.display = 'none';

    const imageData = capturarFrame();

    fetch('/reconocer', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ image: imageData })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(response.statusText);
        }
        return response.json();
    })
    .then(data => {
        if (data.nombre_completo) {
            resultDiv.innerHTML = `Rostro reconocido: ${data.nombre_completo}<br>Número de control: ${data.numero_control}`;
            redirectButtonDiv.style.display = 'block';

            // Mostrar mensaje flotante con audio
            mostrarMensajeFlotante(
                `Rostro reconocido: ${data.nombre_completo}`,
                '/static/audio/rostro_reconocido.mp3'
            );
        } else {
            resultDiv.innerHTML = `Error: ${data.error}`;
        }
    })
    .catch(error => {
        console.error('Rostro no reconocido ', error);
        resultDiv.innerHTML = 'Rostro Invalido no reconocido.';
    })
    .finally(() => {
        loadingDiv.style.display = 'none';
        reconocimientoEnProgreso = false;
    });
}

// Función de redirección cuando se hace clic en el botón
function redireccionar() {
    window.location.href = "http://localhost/SISTEMA_ESCOLAR/Asistencias/escaneo.php";
}
function cerrarServidor() {
    fetch('/cerrarServidor', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    }).catch(error => {
        console.error('Error al cerrar el servidor:', error);
        alert("Hubo un error al intentar cerrar el servidor.");
    });

    // Redirigir directamente
    alert("Servidor cerrado correctamente.");
    window.location.href = "http://localhost/sistema_escolar/escaneo/reconocimiento.html";
}


// Agregar el evento al botón para cerrar el servidor
closeServerButton.addEventListener("click", cerrarServidor);

// Agregar eventos a los botones
startButton.addEventListener("click", startCamera);
stopButton.addEventListener("click", stopCamera);

// Reconocimiento cada 5 segundos
setInterval(() => {
    if (mediaStream && !reconocimientoEnProgreso) {
        reconocerRostro();
    }
}, 5000);

</script>

                
                
                </div>
              </div>
              <div class="u-align-center u-container-style u-image u-layout-cell u-right-cell u-size-30 u-size-xs-60 u-image-1" src="" data-image-width="960" data-image-height="538">
                <div class="u-container-layout u-container-layout-2" src=""></div>
            </div>
          </div>
        </div>
      </div>
    </section>
   
  
  <script>
    function Dar_De_Alta() {
        fetch("../Asistencias/run_python.php")
            .then(response => response.text())
            .then(data => {
                // Muestra la respuesta del script de Python
                console.log(data);
                document.getElementById("result").innerText = data;
            })
            .catch(error => console.error("Error:", error));
    }
  </script>
    
    
    <footer class="u-align-center u-clearfix u-container-align-center u-footer u-grey-80 u-footer" id="sec-9e79"><div class="u-clearfix u-sheet u-sheet-1">
        <p class="u-small-text u-text u-text-variant u-text-1">TESJo -- Unidad de Informática -- Área de Sistemas de la Información </p>
      </div></footer>
    
</body></html>